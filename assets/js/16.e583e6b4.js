(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{225:function(e,n,t){e.exports=t.p+"assets/img/ftdi-verkantet.ba30dcc3.jpg"},273:function(e,n,t){"use strict";t.r(n);var a=t(20),s=Object(a.a)({},function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"software-flashen"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#software-flashen","aria-hidden":"true"}},[e._v("#")]),e._v(" Software / Flashen")]),e._v(" "),a("p",[e._v("Die Software für den Microcontroller wird bei Arduino als "),a("em",[e._v("Sketch")]),e._v(" bezeichnet."),a("br"),e._v("\nDer USB FTDI Adapter ist die Verbindung zwischen Microcontroller und PC.")]),e._v(" "),a("h2",{attrs:{id:"arduino-ide"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arduino-ide","aria-hidden":"true"}},[e._v("#")]),e._v(" Arduino IDE")]),e._v(" "),a("p",[e._v("Die "),a("a",{attrs:{href:"https://www.arduino.cc/en/Main/Software",target:"_blank",rel:"noopener noreferrer"}},[e._v("Arduino IDE"),a("OutboundLink")],1),e._v(" ist die gebräuchlichste\nPC Software für den Umgang mit dem Arduino.")]),e._v(" "),a("h3",{attrs:{id:"bibliothek-einbinden"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bibliothek-einbinden","aria-hidden":"true"}},[e._v("#")]),e._v(" Bibliothek einbinden")]),e._v(" "),a("p",[e._v("Damit die im Sketch verwendeten Bibliotheken zur Verfügung stehen, müssen diese eingebunden werden:")]),e._v(" "),a("ul",[a("li",[e._v("AskSinPP")]),e._v(" "),a("li",[e._v("EnableInterrupt")]),e._v(" "),a("li",[e._v("Low-Power")])]),e._v(" "),a("p",[e._v("Die AskSinPP Bibliothek kann als "),a("a",{attrs:{href:"https://github.com/pa-pa/AskSinPP/archive/V3.zip",target:"_blank",rel:"noopener noreferrer"}},[e._v("ZIP"),a("OutboundLink")],1),e._v("\nheruntergeladen werden.\nAnschließend geht man in der Arduino IDE auf "),a("code",[e._v("Sketch > Bibliothek einbinden > .ZIP-Bibliothek hinzufügen")]),e._v("\nund wählt die ZIP-Datei aus.")]),e._v(" "),a("p",[e._v("EnableInterrupt und Low-Power wird über "),a("code",[e._v("Sketch > Bibliothek einbinden > Bibliotheken verwalten")]),e._v("\ngesucht und installiert.")]),e._v(" "),a("h3",{attrs:{id:"board-einstellen"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#board-einstellen","aria-hidden":"true"}},[e._v("#")]),e._v(" Board einstellen")]),e._v(" "),a("ul",[a("li",[e._v("Board: "),a("code",[e._v("Arduino Pro or Pro Mini")])]),e._v(" "),a("li",[e._v("Prozessor: "),a("code",[e._v("ATmega328P (3.3V, 8 MHz)")])]),e._v(" "),a("li",[e._v("Port: COM-Port des FTDI Adapters")])]),e._v(" "),a("h2",{attrs:{id:"platformio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#platformio","aria-hidden":"true"}},[e._v("#")]),e._v(" PlatformIO")]),e._v(" "),a("p",[e._v("PlatformIO gibt es als vollständige "),a("a",{attrs:{href:"https://platformio.org/platformio-ide",target:"_blank",rel:"noopener noreferrer"}},[e._v("Entwicklungsumgebung"),a("OutboundLink")],1),e._v(" (IDE) und als "),a("a",{attrs:{href:"https://platformio.org/install/cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("Command-Line-Interface"),a("OutboundLink")],1),e._v(" (CLI).")]),e._v(" "),a("p",[e._v("Die nötigen Bibliotheken können über den "),a("a",{attrs:{href:"https://docs.platformio.org/en/latest/librarymanager/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Library Manager"),a("OutboundLink")],1),e._v("\nbequem installiert werden. Er enthält neben den gebräuchlichen EnableInterrupt und Low-Power auch AskSinPP.")]),e._v(" "),a("p",[e._v("Die Konfiguration des Boards kann über das Interface eingestellt werden und wird in der "),a("code",[e._v("platformio.ini")]),e._v(" im\nProjekt-Verzeichnis gespeichert. Diese Datei kann man sich also auch schnell selbst erstellen:")]),e._v(" "),a("div",{staticClass:"language-ini line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[e._v("[env:pro8MHzatmega328]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("platform")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" atmelavr")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("framework")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" arduino")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("board")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),e._v(" pro8MHzatmega328")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("h2",{attrs:{id:"anschluss-des-ftdi-adapters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#anschluss-des-ftdi-adapters","aria-hidden":"true"}},[e._v("#")]),e._v(" Anschluss des FTDI Adapters")]),e._v(" "),a("p",[e._v("Um die Schaltung sehr kompakt zu halten, verzichtet man auf das Anlöten eines Steckverbinders.\nEs reicht aus, wenn man die Pins des FTDI Adapters durch die Lötbohrungen steckt und während des Flash-Vorgangs verkantet.")]),e._v(" "),a("p",[a("img",{attrs:{src:t(225),alt:"FTP Adapter verkantet am Arduino Pro Mini"}})]),e._v(" "),a("h2",{attrs:{id:"sketch-anpassen-und-flashen"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sketch-anpassen-und-flashen","aria-hidden":"true"}},[e._v("#")]),e._v(" Sketch anpassen und flashen")]),e._v(" "),a("p",[e._v("Es gibt mittlerweile viele fertige "),a("router-link",{attrs:{to:"/Sketche/"}},[e._v("Sketche")]),e._v(" die je nach Aktor oder Sensor verwendet werden können."),a("br"),e._v("\nAls Beispiel wird hier der "),a("code",[e._v("HM-RC-P1")]),e._v(" Paniktaster genommen.")],1),e._v(" "),a("p",[e._v("Der komplette Sketch ist "),a("a",{attrs:{href:"https://github.com/pa-pa/AskSinPP/blob/master/examples/HM-RC-P1/HM-RC-P1.ino",target:"_blank",rel:"noopener noreferrer"}},[e._v("HM-RC-P1.ino"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Arduino pin for the config button")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("define")]),e._v(" CONFIG_BUTTON_PIN 8")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Arduino pins for the buttons")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// A0 == PIN 14")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("define")]),e._v(" BTN1_PIN 14")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("p",[e._v("Hier sieht man die Button Belegung und kann diese entsprechend anpassen."),a("br"),e._v("\nFür das Beispiel des Paniktasters schließen wir also einen weiteren Taster an "),a("code",[e._v("A0")]),e._v(" und "),a("code",[e._v("GND")]),e._v(" an.")]),e._v(" "),a("p",[e._v("Weiterhin ist der DeviceInfo Block wichtig:")]),e._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// define all device properties")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("struct")]),e._v(" DeviceInfo PROGMEM devinfo "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x12")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x09")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x01")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Device ID")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"JPLRCP2001"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Device Serial")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x1a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Device Model")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Firmware Version")]),e._v("\n    as"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("::")]),e._v("DeviceType"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("::")]),e._v("Remote"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Device Type")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0x00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("             "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Info Bytes")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br")])]),a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),e._v(" "),a("p",[e._v("Jedes Gerät in einer HomeMatic Umgebung hat 2 eindeutige Identifikationsmerkmale:")]),e._v(" "),a("ul",[a("li",[e._v("die 10-stellige Seriennummer (wird in der WebUI in der Spalte Seriennummer in Einstellungen->Geräte angezeigt)")]),e._v(" "),a("li",[e._v("die 3-Byte Geräteadresse (wird in einer Konfigurationsdatei im Dateisystem gespeichert)")])]),e._v(" "),a("p",[e._v("Beide dürfen in einer HomeMatic-Installation nur "),a("strong",[e._v("1x vergeben")]),e._v(" werden."),a("br"),e._v("\nAusschlaggebend für die Funk-Kommunikation ist die Geräte-Adresse.")])]),e._v(" "),a("p",[e._v("Die Geräteadresse (im Sketch als "),a("code",[e._v("Device ID")]),e._v(" bezeichnet) lautet in diesem Fall "),a("code",[e._v("0x12,0x09,0x01")]),e._v("."),a("br"),e._v("\nDie Seriennummer (im Sketch als "),a("code",[e._v("Device Serial")]),e._v(" bezeichnet) lautet in diesem Fall "),a("code",[e._v("JPLRCP2001")]),e._v(".")]),e._v(" "),a("p",[e._v("Soll ein weiterer, auf diesen Sketch basierender HM-RC-P1 ins HomeMatic System integriert werden, verwendet man (- so mache ich es zumindest-) am besten eine fortlaufende Numerierung. 0x12, 0x09, 0x02 / JPLRCP2002.")]),e._v(" "),a("p",[e._v("Wichtig: Die Seriennummer muss immer 10-stellig sein! Sie darf Buchstaben und Zahlen enthalten.")]),e._v(" "),a("p",[e._v("Sind die Werte angepasst, kann der Programmcode kompiliert und an den Mikrocontroller\nübertragen werden. In der Arduino IDE heißt dieser Vorgang "),a("code",[e._v("Sketch hochladen")]),e._v("\nund bei PlatformIO "),a("code",[e._v("upload")]),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"serieller-monitor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#serieller-monitor","aria-hidden":"true"}},[e._v("#")]),e._v(" Serieller Monitor")]),e._v(" "),a("p",[e._v("Der Arduino verfügt über eine Debug-Ausgabe die vom PC über den "),a("code",[e._v("seriellen Monitor")]),e._v("\nabgerufen werden kann (Arduino IDE: Menü > Werkzeuge > serieller Monitor).\nAus dem Sketch kann man die verwendete Baudrate ablesen:")]),e._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" setup "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("DINIT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("57600")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("ASKSIN_PLUS_PLUS_IDENTIFIER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  sdev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("hal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("Hier also "),a("strong",[e._v("57600 Baud")]),e._v(". Diese muss beim Verbindungsaufbau übereinstimmen, damit man\nnicht nur wirre Zeichen erhält. Weiteres zum "),a("router-link",{attrs:{to:"/Grundlagen/FAQ/Debugging.html"}},[e._v("Debugging")]),e._v(" in den FAQ.")],1)])},[],!1,null,null,null);s.options.__file="02_software.md";n.default=s.exports}}]);